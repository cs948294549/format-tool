<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-cn" lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="zh-cn" />
    <title>XML格式化</title>
    <style>
        .mes-send {
            padding: .65em;
            border: 1px solid #ccc;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            }
        .form-group { padding: 1.25em; }
        .form-group label { vertical-align: top; }
        .mes-send textarea {
            padding: 1px;
            width: 100%;
            height: 200px;
            border: 1px solid #b7b7b7;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
        }
        .mes-get {
            padding: .65em;
            border: 1px solid #ccc;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            }
        .mes-get textarea {
            padding: 1px;
            width: 100%;
            height: 400px;
            border: 1px solid #b7b7b7;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
        }
    </style>
  </head>
<body>
<section class="mes-send">
    <div class="form-group">
            <label>转换的字符串：</label>
            <textarea id="xmlString"></textarea>
    </div>
     <label>缩进：</label>
     <input id="padding" type="text" name="suojin" />
     <button id="submit" onclick="postData()" title="转换字符串">转换</button>
     <button id="clear" onclick="clearData()" title="清空数据">清除</button>
</section>
<section class="mes-get">
<div class="form-group">
    <label>转换结果：</label>
    <div id="transStr"></div>
</div>
</section>
</body>
 <script>
function createXml(str){
    if(document.all){ 　　
        var xmlDom=new ActiveXObject("Microsoft.XMLDOM"); 　　
        xmlDom.loadXML(str);
        return xmlDom; 　　
    } 　　
    else{ 　
        return new DOMParser().parseFromString(str, "text/xml"); 
    }
}

var padding=" ";

function getxmlformat_ex(xmlObj,padding_data){
    var str1="";
    console.log("do========",xmlObj,"padding=======",padding_data);
    if(xmlObj.childNodes.length==0){
        var entityStr="";
        if(xmlObj.nodeType==8){
        	//write xml:<device><!--*****--></device>
            entityStr="&lt;!--"+xmlObj.data+"--&gt;\n";
            str1=str1+padding.repeat(padding_data)+entityStr;
        }else if(xmlObj.nodeType==3){
        	//write xml:<device>*****</device>
            entityStr=xmlObj.data;
            entityStr=entityStr.replace(/(^\s*)|(\s*$)/g,"");
            if(entityStr!=""){
            	entityStr=entityStr+"\n";
            	str1=str1+padding.repeat(padding_data)+entityStr;
            }
        }else if(xmlObj.nodeType==1){
        	//write xml:<device />
        	entityStr="&lt;"+xmlObj.tagName+"/&gt;\n";
        	str1=str1+padding.repeat(padding_data)+entityStr;
        }
        console.log(str1);
    }else{
    	//get xml version
    	console.log("version==============",xmlObj.attributes);
    	var version="";
    	for(var v=0;v<xmlObj.attributes.length;v++){
    		version=version+xmlObj.attributes[v].nodeName;
    		version=version+"=";
    		version=version+"\""+xmlObj.attributes[v].nodeValue+"\" ";
    	}
    	version=version.replace(/\s*$/g,"");

    	//nodetype=1, write xml version
    	if(version==""){
    		str1=str1+padding.repeat(padding_data)+"&lt;"+xmlObj.tagName+"&gt;\n";
    	}else{
        	str1=str1+padding.repeat(padding_data)+"&lt;"+xmlObj.tagName+" "+version+"&gt;\n";
        }
        for(var i=0;i<xmlObj.childNodes.length;i++){
            str1=str1+getxmlformat_ex(xmlObj.childNodes[i],padding_data+1);
        }
        str1=str1+padding.repeat(padding_data)+"&lt;/"+xmlObj.tagName+"&gt;\n";
    }
    return str1;
}

function postData(){
    var padding_num=document.getElementById("padding").value;
    console.log("padding=========================",padding_num);
    padding=" ".repeat(padding_num);
    document.getElementById("transStr").innerHTML='';

    var xmlStr=document.getElementById("xmlString").value;// xml字符串

    //format string
    xmlStr=xmlStr.replace(/[\r\n]/g, "");
    console.log("1st",xmlStr);
    xmlStr=xmlStr.replace(/\—/g, "--");
    console.log("2st",xmlStr);

    //trans xml
    var xmlFormat = createXml(xmlStr);
    console.log(xmlFormat);
    var root=xmlFormat.documentElement;

    console.log("root=============",root);
    var html="<pre>"+getxmlformat_ex(root,0)+"</pre>";
    document.getElementById("transStr").innerHTML=html;
      }
function clearData(){
	document.getElementById("xmlString").value='';
	document.getElementById("transStr").innerHTML='';
}
</script>
</html>